import{w as E}from"./with-props-DY0BKT3b.js";import{j as c}from"./jsx-runtime-BjG_zV1W.js";import{r as o,O as j}from"./chunk-KNED5TY2-Bs4SCV26.js";import{M as k,L as v,a as P,U as S}from"./Localized-DN1VtFTN.js";import{u as b}from"./LocalizationProvider-Dno7Hz9s.js";import{a as g}from"./notifications.store-DJz-Y7bD.js";import"./Text-DECK_xVw.js";import"./polymorphic-factory-BIZ5vAp8.js";import"./random-id-CQPYUG5g.js";const C={farewellBackground:!0},M=o.createContext({...C,enable:()=>{},disable:()=>{},toggle:()=>{}}),R=({children:t})=>{const[r,n]=o.useState(C),u=s=>n(f=>({...f,[s]:!0})),e=s=>n(f=>({...f,[s]:!1})),i=s=>n(f=>({...f,[s]:!f[s]}));return c.jsx(M.Provider,{value:{...r,enable:u,disable:e,toggle:i},children:t})},d=(t,r)=>typeof t=="object"&&t!==null?{x:t.x||0,y:t.y||0}:{x:t||0,y:r||0};d(0,0);d(1,1);d(.3,.3),d(.3,.3),d(.5,.5),d(.5,.5);function A(t){return new Worker("/assets/effects.worker-WEyZr2bn.js",{name:t==null?void 0:t.name})}const L=t=>r=>r[t.type]?r[t.type](t.data):r._(),W=({onDimensionsChange:t,onInitialized:r})=>{const n=o.useRef(null),u=o.useRef(null);return o.useEffect(()=>{if(!n.current)return;const e=n.current,i=e.transferControlToOffscreen(),s=new A;return u.current=s,s.postMessage({type:"init",data:{canvas:i,dimensions:{x:e.clientWidth,y:e.clientHeight}}},[i]),s.onmessage=f=>{const p=f.data;L(p)({initialized:()=>{console.log("Effects worker initalized")}})},()=>{s.terminate(),u.current=null}},[]),b("mousemove",e=>{var s;const i=d(e.clientX,e.clientY);(s=u.current)==null||s.postMessage({type:"mousemove",data:{pos:i}})}),b("resize",()=>{var i;if(!n.current)return;const e=d(n.current.clientWidth,n.current.clientHeight);(i=u.current)==null||i.postMessage({type:"dimensionsChange",data:{dimensions:e}})}),{ref:n}},z=()=>{const{ref:t}=W({});return c.jsxs("div",{className:"pageBackground",children:[c.jsx("div",{id:"rr1",style:{position:"absolute",left:0,bottom:0}}),c.jsx("div",{id:"rr2",style:{position:"absolute",right:0,bottom:0}}),c.jsx("canvas",{className:"pageBackground",style:{width:"100vw",height:"100vh",imageRendering:"pixelated"},ref:t})]})},I=({children:t})=>{const r=o.useRef(null),n=o.useRef(null),u=o.useRef(null),[e,i]=o.useState(null),[s,f]=o.useState(!1),[p,O]=o.useState(!1);o.useEffect(()=>{let a=new Audio;return r.current=a,()=>{var l;(l=n.current)==null||l.close(),a.pause(),a.remove(),r.current=null}},[]),o.useEffect(()=>{if(!r.current)return;const a=new AbortController,{signal:l}=a;return r.current.addEventListener("playing",()=>{g.hide("music-error")},{signal:l}),()=>a.abort()},[]),o.useEffect(()=>{if(!r.current)return;const a=new AbortController,{signal:l}=a;return r.current.addEventListener("ended",()=>{if(!e)return;const m=k;let w=m.indexOf(e);if(w==-1)return;let y=w+1;y>=m.length&&(y=0);let h=m[y];h&&i(h)},{signal:l}),()=>a.abort()},[e]),o.useEffect(()=>{if(e)return g.show({id:"music-nowplaying",title:c.jsx(v,{en:"Now Playing",tr:"Şimdi Çalıyor"}),message:e.title}),()=>void g.hide("music-nowplaying");g.hide("music-nowplaying")},[e]);const x=()=>{var a;(a=r.current)==null||a.play().then(()=>{n.current=new AudioContext;let l=n.current.createMediaElementSource(r.current);u.current=n.current.createAnalyser(),l.connect(u.current),l.connect(n.current.destination)}).catch(l=>{if(l instanceof DOMException&&l.name=="NotAllowedError"){g.show({id:"music-error",message:c.jsx(v,{en:"Can't play music, please click anywhere",tr:"Müzik çalınamıyor, herhangi bir yere tıklayın"}),autoClose:!1,position:"top-center",color:"yellow"});const m=()=>x();window.addEventListener("click",m,{once:!0})}})};return o.useEffect(()=>{r.current&&(r.current.pause(),r.current.src=e?`/assets/music/${e.file}`:"",e&&x())},[e]),c.jsx(P.Provider,{value:{ref:r,loading:s,playing:p,currentSong:e,analyser:u,audioContext:n,changeCurrentSong:i},children:t})},X=E(function(){return c.jsx(R,{children:c.jsx(S,{children:c.jsxs(I,{children:[c.jsx(z,{}),c.jsx(j,{})]})})})});export{X as default};
