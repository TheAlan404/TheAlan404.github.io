var U=Object.defineProperty;var M=(t,n,e)=>n in t?U(t,n,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[n]=e;var u=(t,n,e)=>M(t,typeof n!="symbol"?n+"":n,e);import{w as D}from"./with-props-CCmlLKWz.js";import{j as A}from"./jsx-runtime-BjG_zV1W.js";import{r as c,O as N}from"./chunk-GNGMS2XR-D0nGIQkJ.js";import{U as F}from"./UIContext-D3TJat-E.js";import{c as y}from"./clamp-DTmYCdls.js";import{a as _}from"./notifications.store-yyozdE4G.js";import"./random-id-CQPYUG5g.js";function P(t,n,e){c.useEffect(()=>(window.addEventListener(t,n,e),()=>window.removeEventListener(t,n,e)),[t,n])}const b={farewellBackground:!0},L=c.createContext({...b,enable:()=>{},disable:()=>{},toggle:()=>{}}),O=({children:t})=>{const[n,e]=c.useState(b),r=s=>e(l=>({...l,[s]:!0})),o=s=>e(l=>({...l,[s]:!1})),i=s=>e(l=>({...l,[s]:!l[s]}));return A.jsx(L.Provider,{value:{...n,enable:r,disable:o,toggle:i},children:t})},G=t=>a(t,t),a=(t,n)=>typeof t=="object"&&t!==null?{x:t.x||0,y:t.y||0}:{x:t||0,y:n||0},x=t=>typeof t=="object"&&t?a(t):G(t),V=(t,n)=>t.x==n.x&&t.y==n.y,E=(...t)=>t.map(x).reduce((n,e)=>a(n.x+e.x,n.y+e.y)),C=(...t)=>t.map(x).reduce((n,e)=>a(n.x*e.x,n.y*e.y)),v=(t,n)=>E(t,C(n,-1)),R=(t,n)=>{let e=x(t),r=x(n);return a(e.x/r.x,e.y/r.y)},j=t=>{let n=x(t);return Math.sqrt(n.x**2+n.y**2)},Y=t=>R(t,j(t));a(0,0);a(1,1);const q=({onInitialize:t,onInitializeFail:n,onDestroy:e,onResize:r}={})=>{let o=c.useRef(null),i=c.useRef(null);return c.useEffect(()=>{if(!o.current)return;o.current.width=o.current.clientWidth,o.current.height=o.current.clientHeight;const s=o.current.getContext("webgl2",{antialias:!1,powerPreference:"low-power",desynchronized:!0,failIfMajorPerformanceCaveat:!0});if(!s){console.log("WebGL2RenderingContext initialize failed"),n==null||n();return}return i.current=s,t==null||t(s),s.viewport(0,0,o.current.width,o.current.height),r==null||r(a(o.current.width,o.current.height),o.current),()=>{e==null||e(),i.current=null}},[o.current]),P("resize",()=>{var s;o.current&&(o.current.width=o.current.clientWidth,o.current.height=o.current.clientHeight,(s=i.current)==null||s.viewport(0,0,o.current.width,o.current.height),r==null||r(a(o.current.width,o.current.height),o.current))}),{ref:o,gl:i}};class Q{constructor(){u(this,"id","");u(this,"dimensions",a());u(this,"mousePosition",null);u(this,"scrollPosition",a())}onDimensionsChange(n){this.dimensions=n}onScrollPositionChange(n){this.scrollPosition=n}onMouseMove(n){this.mousePosition=n}update(n){}render(){}}class k extends Q{constructor(e){super();u(this,"gl");u(this,"program");u(this,"bindings",{});u(this,"scale",1);this.gl=e,this.program=e.createProgram()}onDimensionsChange(e){this.dimensions=e}updateViewport(){this.gl.viewport(0,0,this.dimensions.x*this.scale,this.dimensions.y*this.scale)}binding(e,r){return e=="a"?this.gl.getAttribLocation(this.program,`${e}_${r}`):this.gl.getUniformLocation(this.program,`${e}_${r}`)}createBuffer(e){const r=this.gl.createBuffer();return this.gl.bindBuffer(this.gl.ARRAY_BUFFER,r),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array(e),this.gl.STATIC_DRAW),r}bindBuffer(e,r,o=1){this.gl.bindBuffer(this.gl.ARRAY_BUFFER,r),this.gl.enableVertexAttribArray(this.bindings[e]),this.gl.vertexAttribPointer(this.bindings[e],o,this.gl.FLOAT,!1,0,0)}uniformVec2(e,r){this.gl.uniform2f(this.bindings[e],r.x,r.y)}}const w=(t,n,e)=>{const r=t.createShader(n);return r?(t.shaderSource(r,e),t.compileShader(r),t.getShaderParameter(r,t.COMPILE_STATUS)?r:(console.error("SHADER COMPILATION ERROR",e),console.error(t.getShaderInfoLog(r)),t.deleteShader(r),null)):null},H=(t,n)=>{const e=t.createProgram();for(let r of n)t.attachShader(e,r);return t.linkProgram(e),t.getProgramParameter(e,t.LINK_STATUS)?e:(console.error(t.getProgramInfoLog(e)),t.deleteProgram(e),null)},X=(t,n)=>{const e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array([0,0,0,0]));const r=new Image;return r.onload=()=>{t.bindTexture(t.TEXTURE_2D,e),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,r),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST)},r.src=n,e},W=(t=1)=>Math.round(Math.random()*t),g=(t=1)=>Math.random()*t,K=(t,n)=>Math.random()>.5?t:n,S=(t,n,e)=>t+(n-t)*e,J=["data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAHUlEQVR4Ae3OAQ0AAAABMP1Lo4UxT3Dg1tGqwhcjpd4D/epMC1wAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAIklEQVR4Ae3MsQ0AAAzCMP5/uuUHGBDCewJMuCM5tkym3gOLZg/xodIpmQAAAABJRU5ErkJggg==","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAMklEQVR4Ae3PSwoAAAQEUNz/zlgrn5KymLc2MyGCW+q6G9mO8HSZ3bgglmTh9oUqCJ8YQAgMB0rhaRAAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAQElEQVR4Ae2RSw4AMAREjfvfuZV01/hNbL0140FkSTlGVYNOMwwqwJschYBW/oLA7O1ZjFfQ7vEiM610sw8sjwsTECAKHmlhcAAAAABJRU5ErkJggg=="],$=`
    attribute vec2 a_position;
    attribute float a_textureIndex;
    attribute float a_opacity;
    uniform vec2 u_scroll;
    uniform vec2 u_dim;
    uniform vec2 u_scrollPosition;
    varying float v_opacity;
    varying float v_flash;
    varying float v_textureIndex;
    uniform vec2 u_mousePosition;
    
    void main() {
        gl_PointSize = 32.0;

        vec2 position = mod(a_position - u_scrollPosition, u_dim);

        //float mouseDistance = sqrt(pow(position.x - u_mousePosition.x, 2.0) + pow(position.y - u_mousePosition.y, 2.0));
        // float threshold = 50.0;
        // float moveDistance = max(0.0, threshold - mouseDistance);
        // vec2 directionToMouse = normalize(position - u_mousePosition);
        // vec2 moveAway = directionToMouse * moveDistance * 1.0;
        // position += moveAway;

        vec2 clipSpace = ((position / u_dim) * 2.0) - 1.0;
        gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);

        // Pass attributes to the fragment shader
        v_opacity = a_opacity;
        v_textureIndex = a_textureIndex;
        // v_flash = mouseDistance / 50.0;
    }
`,Z=`
    precision mediump float;
    uniform sampler2D u_textures[4];
    uniform vec3 u_color;
    uniform float u_flash;
    varying float v_flash;
    varying float v_opacity;
    varying float v_textureIndex;

    void main() {
        vec4 textureColor;

        int texIndex = int(floor(v_textureIndex + 0.5));

        if (texIndex == 0) {
            textureColor = texture2D(u_textures[0], gl_PointCoord);
        } else if (texIndex == 1) {
            textureColor = texture2D(u_textures[1], gl_PointCoord);
        } else if (texIndex == 2) {
            textureColor = texture2D(u_textures[2], gl_PointCoord);
        }  else if (texIndex == 3) {
            textureColor = texture2D(u_textures[3], gl_PointCoord);
        } else {
            // Fallback
            textureColor = vec4(1.0, 0.0, 0.0, 1.0);
        }

        gl_FragColor = vec4(
            (textureColor.rgb * u_color + (
                textureColor.a * u_flash * v_flash * vec3(1.0,1.0,1.0)
            )),
            textureColor.a * v_opacity + ((textureColor.a * u_flash) / 3.0)
        );
    }
`,z=[{color:"ab6ffa",scroll:a(.3,.3)},{color:"71d5ff",scroll:a(.3,.3),flowSpeed:2.5},{color:"53f3dd",scroll:a(.5,.5)},{color:"cefdff",scroll:a(.5,.5),flowSpeed:3}];class ee extends k{constructor(e){super(e);u(this,"id","farewell");u(this,"textures");u(this,"starfields",[]);u(this,"globalPosition",a());u(this,"globalFlash",0);u(this,"scale",1);u(this,"deltaTimeMultiplier",.002);this.program=H(e,[w(e,e.VERTEX_SHADER,$),w(e,e.FRAGMENT_SHADER,Z)]),this.textures=Array(4).fill(0).map((r,o)=>X(e,J[o])),this.bindings={color:this.binding("u","color"),dim:this.binding("u","dim"),flash:this.binding("u","flash"),opacity:this.binding("a","opacity"),position:this.binding("a","position"),textureIndex:this.binding("a","textureIndex"),scroll:this.binding("u","scroll"),scrollPosition:this.binding("u","scrollPosition"),mousePosition:this.binding("u","mousePosition")},this.createStarfields()}onDimensionsChange(e){this.dimensions=e,this.createStarfields()}update(e){for(let r of this.starfields)for(let o of r.stars)this.updateStar(r.config,o,e)}createStarfields(){this.starfields=z.map(e=>this.createStarfield(e))}createStarfield(e){let r={yNodes:[],color:"ffffff",flowSpeed:1,scroll:a(1),...e};r.yNodes=this.createYNodes();let o=this.createStars(r);return{config:r,stars:o}}stepsH(){return 100}stepsW(){return 100}stepSize(){return this.stepsW()}createYNodes(){let e=[],r=g(this.dimensions.y),o=0;for(;this.stepsH()>o;)o++,e.push(r),r+=K(-1,1)*(16*2+g(24*(this.dimensions.y/360)*2));for(let i=0;i<4;i++)e[e.length-1-i]=S(e[e.length-1-i],e[0],y(0,1-i/4,1));return e}createStars(e){return new Array(128).fill(0).map(()=>{let o=g(1),i={NodeIndex:W(e.yNodes.length-1),NodePercent:g(1),Distance:4+o*20,Sine:g(Math.PI*2)},s=Math.floor(y(0,Math.pow(1-o,3)*4,3));return{...i,Position:this.targetOfStar(e,i),Opacity:S(.6,0,o*.5),Texture:s}})}targetOfStar({yNodes:e},r){let o=this.stepSize(),i={x:r.NodeIndex*o,y:e[r.NodeIndex]},s={x:(r.NodeIndex+1)*o,y:e[r.NodeIndex+1]},l=E(i,C(v(s,i),a(r.NodePercent))),h=Y(v(s,i));return{x:l.x+-h.x*r.Distance*Math.sin(r.Sine),y:l.y+h.y*r.Distance*Math.sin(r.Sine)}}updateStar(e,r,o=1){r.Sine+=o*e.flowSpeed*this.deltaTimeMultiplier,r.NodePercent+=o*.25*e.flowSpeed*this.deltaTimeMultiplier,r.NodePercent>=1&&(r.NodePercent-=1,r.NodeIndex++,r.NodeIndex>=e.yNodes.length-1&&(r.NodeIndex=0,r.Position.x=0)),r.Position=E(r.Position,R(v(this.targetOfStar(e,r),r.Position),a(50,50)))}render(){this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA),this.gl.blendEquation(this.gl.FUNC_ADD),this.gl.enable(this.gl.BLEND),this.gl.useProgram(this.program),this.gl.uniform1f(this.bindings.flash,0),this.uniformVec2("dim",this.dimensions),this.uniformVec2("scrollPosition",this.scrollPosition),this.uniformVec2("mousePosition",this.mousePosition||a(-1,-1));for(let e=0;e<this.textures.length;e++){const r=this.textures[e];this.gl.activeTexture(this.gl["TEXTURE"+e]),this.gl.bindTexture(this.gl.TEXTURE_2D,r),this.gl.uniform1i(this.gl.getUniformLocation(this.program,`u_textures[${e}]`),e)}for(let e of this.starfields)this.renderDrawStarfield(e)}renderDrawStarfield(e){this.uniformVec2("scroll",e.config.scroll);const r=parseInt(e.config.color.slice(0,2),16)/255,o=parseInt(e.config.color.slice(2,4),16)/255,i=parseInt(e.config.color.slice(4,6),16)/255;this.gl.uniform3f(this.bindings.color,r,o,i);const s=[],l=[],h=[];e.stars.forEach(f=>{s.push(f.Position.x,f.Position.y),l.push(f.Opacity),h.push(f.Texture)});const p=this.createBuffer(new Float32Array(s)),m=this.createBuffer(new Float32Array(l)),d=this.createBuffer(new Float32Array(h));this.bindBuffer("position",p,2),this.bindBuffer("opacity",m),this.bindBuffer("textureIndex",d),this.gl.drawArrays(this.gl.POINTS,0,e.stars.length),this.gl.deleteBuffer(m),this.gl.deleteBuffer(p),this.gl.deleteBuffer(d)}}const te=({render:t,deltaTimeFPS:n=30})=>{c.useEffect(()=>{let e=0,r=performance.now();const o=1e3/n,i=s=>{let l=(s-r)/o;r=s;let h=Math.min(l,n);t(h),e=requestAnimationFrame(i)};return e=requestAnimationFrame(i),()=>{cancelAnimationFrame(e)}},[t])},T=({update:t,fps:n=30})=>{c.useEffect(()=>{let e=performance.now();const r=setInterval(()=>{let o=performance.now();t((o-e)/n,o-e),e=o},1e3/n);return()=>clearInterval(r)},[t,n])},I=c.createContext({ref:{current:null},analyser:{current:null},audioContext:{current:null},currentSong:null,loading:!0,playing:!1}),re=()=>{var e;const{analyser:t}=c.useContext(I),n=c.useRef(new Uint8Array(((e=t.current)==null?void 0:e.frequencyBinCount)||0));return T({update:()=>{t.current&&(n.current.length!==t.current.frequencyBinCount&&(n.current=new Uint8Array(t.current.frequencyBinCount)),t.current.getByteFrequencyData(n.current))}}),n},ne=()=>{const t=c.useRef([]);re();const n=o=>{for(let i of t.current)V(o,i.dimensions)||i.onDimensionsChange(o)},{ref:e,gl:r}=q({onInitialize:o=>{t.current=[new ee(o)],n({x:o.canvas.width,y:o.canvas.height})},onDestroy:()=>{t.current=[]},onResize:o=>{n(o)}});return te({render:()=>{var o,i;(o=r.current)==null||o.clearColor(0,0,0,0),(i=r.current)==null||i.clear(r.current.COLOR_BUFFER_BIT);for(let s of t.current)s.render()}}),T({fps:30,update:o=>{for(let i of t.current)i.update(1*o)}}),P("mousemove",o=>{for(let i of t.current)i.onMouseMove(a(o.clientX,o.clientY))}),{ref:e,gl:r,store:t}},oe=()=>{const{ref:t}=ne();return A.jsx("canvas",{className:"pageBackground",style:{width:"100vw",height:"100vh",imageRendering:"pixelated"},ref:t})},ie=({children:t})=>{const n=c.useRef(null),e=c.useRef(null),r=c.useRef(null),[o,i]=c.useState(null),[s,l]=c.useState(!1),[h,p]=c.useState(!1);c.useEffect(()=>{let d=new Audio;return n.current=d,d.loop=!0,()=>{var f;(f=e.current)==null||f.close(),d.pause(),d.remove(),n.current=null}},[]),c.useEffect(()=>{n.current&&(n.current.onplaying=()=>{_.hide("music")})},[n.current]);const m=()=>{var d;(d=n.current)==null||d.play().then(()=>{e.current=new AudioContext;let f=e.current.createMediaElementSource(n.current);r.current=e.current.createAnalyser(),f.connect(r.current),f.connect(e.current.destination)}).catch(f=>{if(f instanceof DOMException&&f.name=="NotAllowedError"){_.show({id:"music",message:"Can't play music, please click anywhere",autoClose:!1});const B=()=>m();window.addEventListener("click",B,{once:!0})}})};return c.useEffect(()=>{n.current&&(n.current.src=(o==null?void 0:o.file)||"",o&&m())},[o]),A.jsx(I.Provider,{value:{ref:n,loading:s,playing:h,currentSong:o,analyser:r,audioContext:e},children:t})},Ae=D(function(){return A.jsx(O,{children:A.jsx(F,{children:A.jsxs(ie,{children:[A.jsx(oe,{}),A.jsx(N,{})]})})})});export{Ae as default};
