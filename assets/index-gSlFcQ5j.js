var U=Object.defineProperty;var D=(t,i,e)=>i in t?U(t,i,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[i]=e;var l=(t,i,e)=>D(t,typeof i!="symbol"?i+"":i,e);import{w as F}from"./with-props-DY0BKT3b.js";import{j as A}from"./jsx-runtime-BjG_zV1W.js";import{r as f,O}from"./chunk-KNED5TY2-Bs4SCV26.js";import{c as P,M as L,a as V,U as G}from"./data-BuIrVpFa.js";import{u as C}from"./use-window-event-gPnLv2ol.js";import{a as p}from"./notifications.store-DJz-Y7bD.js";import"./random-id-CQPYUG5g.js";const B={farewellBackground:!0},j=f.createContext({...B,enable:()=>{},disable:()=>{},toggle:()=>{}}),Y=({children:t})=>{const[i,e]=f.useState(B),r=n=>e(s=>({...s,[n]:!0})),o=n=>e(s=>({...s,[n]:!1})),a=n=>e(s=>({...s,[n]:!s[n]}));return A.jsx(j.Provider,{value:{...i,enable:r,disable:o,toggle:a},children:t})},k=t=>c(t,t),c=(t,i)=>typeof t=="object"&&t!==null?{x:t.x||0,y:t.y||0}:{x:t||0,y:i||0},v=t=>typeof t=="object"&&t?c(t):k(t),Q=(t,i)=>t.x==i.x&&t.y==i.y,y=(...t)=>t.map(v).reduce((i,e)=>c(i.x+e.x,i.y+e.y)),I=(...t)=>t.map(v).reduce((i,e)=>c(i.x*e.x,i.y*e.y)),_=(t,i)=>y(t,I(i,-1)),M=(t,i)=>{let e=v(t),r=v(i);return c(e.x/r.x,e.y/r.y)},H=t=>{let i=v(t);return Math.sqrt(i.x**2+i.y**2)},W=t=>M(t,H(t));c(0,0);c(1,1);class X{constructor(){l(this,"id","");l(this,"dimensions",c());l(this,"mousePosition",null);l(this,"scrollPosition",c())}onDimensionsChange(i){this.dimensions=i}onScrollPositionChange(i){this.scrollPosition=i}onMouseMove(i){this.mousePosition=i}update(i){}render(){}}class q extends X{constructor(e){super();l(this,"gl");l(this,"program");l(this,"bindings",{});l(this,"scale",1);this.gl=e,this.program=e.createProgram()}onDimensionsChange(e){this.dimensions=e}updateViewport(){this.gl.viewport(0,0,this.dimensions.x*this.scale,this.dimensions.y*this.scale)}binding(e,r){return e=="a"?this.gl.getAttribLocation(this.program,`${e}_${r}`):this.gl.getUniformLocation(this.program,`${e}_${r}`)}createBuffer(){return this.gl.createBuffer()}writeBuffer(e,r){return this.gl.bindBuffer(this.gl.ARRAY_BUFFER,e),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array(r),this.gl.STATIC_DRAW),e}writeAndBindBuffer(e,r,o,a=1){this.gl.bindBuffer(this.gl.ARRAY_BUFFER,r),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array(o),this.gl.STATIC_DRAW);let n=this.bindings[e];this.gl.enableVertexAttribArray(n),this.gl.vertexAttribPointer(n,a,this.gl.FLOAT,!1,0,0)}bindBuffer(e,r,o=1){this.gl.bindBuffer(this.gl.ARRAY_BUFFER,r),this.gl.enableVertexAttribArray(this.bindings[e]),this.gl.vertexAttribPointer(this.bindings[e],o,this.gl.FLOAT,!1,0,0)}uniformVec2(e,r){this.gl.uniform2f(this.bindings[e],r.x,r.y)}}const R=(t,i,e)=>{const r=t.createShader(i);return r?(t.shaderSource(r,e),t.compileShader(r),t.getShaderParameter(r,t.COMPILE_STATUS)?r:(console.error("SHADER COMPILATION ERROR",e),console.error(t.getShaderInfoLog(r)),t.deleteShader(r),null)):null},K=(t,i)=>{const e=t.createProgram();for(let r of i)t.attachShader(e,r);return t.linkProgram(e),t.getProgramParameter(e,t.LINK_STATUS)?e:(console.error(t.getProgramInfoLog(e)),t.deleteProgram(e),null)},$=(t,i)=>{const e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array([0,0,0,0]));const r=new Image;return r.onload=()=>{t.bindTexture(t.TEXTURE_2D,e),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,r),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST)},r.src=i,e},J=(t=1)=>Math.round(Math.random()*t),x=(t=1)=>Math.random()*t,Z=(t,i)=>Math.random()>.5?t:i,T=(t,i,e)=>t+(i-t)*e,z=["data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAHUlEQVR4Ae3OAQ0AAAABMP1Lo4UxT3Dg1tGqwhcjpd4D/epMC1wAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAIklEQVR4Ae3MsQ0AAAzCMP5/uuUHGBDCewJMuCM5tkym3gOLZg/xodIpmQAAAABJRU5ErkJggg==","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAMklEQVR4Ae3PSwoAAAQEUNz/zlgrn5KymLc2MyGCW+q6G9mO8HSZ3bgglmTh9oUqCJ8YQAgMB0rhaRAAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAQElEQVR4Ae2RSw4AMAREjfvfuZV01/hNbL0140FkSTlGVYNOMwwqwJschYBW/oLA7O1ZjFfQ7vEiM610sw8sjwsTECAKHmlhcAAAAABJRU5ErkJggg=="],ee=`
    attribute vec2 a_position;
    attribute float a_textureIndex;
    attribute float a_opacity;
    uniform float u_pointSize;
    uniform vec2 u_scroll;
    uniform vec2 u_dim;
    uniform vec2 u_scrollPosition;
    varying float v_opacity;
    varying float v_flash;
    varying float v_textureIndex;
    uniform vec2 u_mousePosition;
    
    void main() {
        gl_PointSize = u_pointSize;

        vec2 position = mod(a_position - u_scrollPosition, u_dim);

        //float mouseDistance = sqrt(pow(position.x - u_mousePosition.x, 2.0) + pow(position.y - u_mousePosition.y, 2.0));
        // float threshold = 50.0;
        // float moveDistance = max(0.0, threshold - mouseDistance);
        // vec2 directionToMouse = normalize(position - u_mousePosition);
        // vec2 moveAway = directionToMouse * moveDistance * 1.0;
        // position += moveAway;

        vec2 clipSpace = ((position / u_dim) * 2.0) - 1.0;
        gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);

        // Pass attributes to the fragment shader
        v_opacity = a_opacity;
        v_textureIndex = a_textureIndex;
        // v_flash = mouseDistance / 50.0;
    }
`,te=`
    precision mediump float;
    uniform sampler2D u_textures[4];
    uniform vec3 u_color;
    uniform float u_flash;
    varying float v_flash;
    varying float v_opacity;
    varying float v_textureIndex;

    void main() {
        vec4 textureColor;

        int texIndex = int(floor(v_textureIndex + 0.5));

        if (texIndex == 0) {
            textureColor = texture2D(u_textures[0], gl_PointCoord);
        } else if (texIndex == 1) {
            textureColor = texture2D(u_textures[1], gl_PointCoord);
        } else if (texIndex == 2) {
            textureColor = texture2D(u_textures[2], gl_PointCoord);
        }  else if (texIndex == 3) {
            textureColor = texture2D(u_textures[3], gl_PointCoord);
        } else {
            // Fallback
            textureColor = vec4(1.0, 0.0, 0.0, 1.0);
        }

        gl_FragColor = vec4(
            (textureColor.rgb * u_color + (
                textureColor.a * u_flash * v_flash * vec3(1.0,1.0,1.0)
            )),
            textureColor.a * v_opacity + ((textureColor.a * u_flash) / 3.0)
        );
    }
`,re=[{color:"ab6ffa",scroll:c(.3,.3)},{color:"71d5ff",scroll:c(.3,.3),flowSpeed:2.5},{color:"53f3dd",scroll:c(.5,.5)},{color:"cefdff",scroll:c(.5,.5),flowSpeed:3}];class ie extends q{constructor(e){super(e);l(this,"id","farewell");l(this,"textures");l(this,"buffers");l(this,"starfields",[]);l(this,"globalPosition",c());l(this,"globalFlash",0);l(this,"scale",1);l(this,"deltaTimeMultiplier",.002);l(this,"speedMultiplier",1);l(this,"speedMultiplierDecay",1);this.program=K(e,[R(e,e.VERTEX_SHADER,ee),R(e,e.FRAGMENT_SHADER,te)]),this.textures=Array(4).fill(0).map((r,o)=>$(e,z[o])),this.bindings={color:this.binding("u","color"),dim:this.binding("u","dim"),flash:this.binding("u","flash"),opacity:this.binding("a","opacity"),position:this.binding("a","position"),textureIndex:this.binding("a","textureIndex"),scroll:this.binding("u","scroll"),scrollPosition:this.binding("u","scrollPosition"),mousePosition:this.binding("u","mousePosition"),pointSize:this.binding("u","pointSize")},this.createStarfields(),this.buffers={texture:this.createBuffer(),opacity:this.createBuffer(),position:this.createBuffer()}}onDimensionsChange(e){this.dimensions=e,this.createStarfields()}isSmallDims(){return this.dimensions.x<100||this.dimensions.y<100}update(e){for(let r of this.starfields)for(let o of r.stars)this.updateStar(r.config,o,e)}createStarfields(){this.starfields=re.map(e=>this.createStarfield(e))}createStarfield(e){let r={yNodes:[],color:"ffffff",flowSpeed:1,scroll:c(1),...e};r.yNodes=this.createYNodes();let o=this.createStars(r);return{config:r,stars:o}}stepsH(){return 100}stepsW(){return 100}stepSize(){return this.stepsW()}createYNodes(){let e=[],r=x(this.dimensions.y),o=0;for(;this.stepsH()>o;)o++,e.push(r),r+=Z(-1,1)*(16*2+x(24*(this.dimensions.y/360)*2));for(let a=0;a<4;a++)e[e.length-1-a]=T(e[e.length-1-a],e[0],P(0,1-a/4,1));return e}createStars(e){let r=this.isSmallDims()?16:128;return new Array(r).fill(0).map(()=>{let a=x(1),n={NodeIndex:J(e.yNodes.length-1),NodePercent:x(1),Distance:4+a*20,Sine:x(Math.PI*2)},s=Math.floor(P(0,Math.pow(1-a,3)*4,3));return{...n,Position:this.targetOfStar(e,n),Opacity:T(.6,0,a*.5),Texture:s}})}targetOfStar({yNodes:e},r){let o=this.stepSize(),a={x:r.NodeIndex*o,y:e[r.NodeIndex]},n={x:(r.NodeIndex+1)*o,y:e[r.NodeIndex+1]},s=y(a,I(_(n,a),c(r.NodePercent))),u=W(_(n,a));return{x:s.x+-u.x*r.Distance*Math.sin(r.Sine),y:s.y+u.y*r.Distance*Math.sin(r.Sine)}}updateStar(e,r,o=1){r.Sine+=o*e.flowSpeed*this.deltaTimeMultiplier*this.speedMultiplier,r.NodePercent+=o*.25*e.flowSpeed*this.deltaTimeMultiplier*this.speedMultiplier,r.NodePercent>=1&&(r.NodePercent-=1,r.NodeIndex++,r.NodeIndex>=e.yNodes.length-1&&(r.NodeIndex=0,r.Position.x=0)),r.Position=y(r.Position,M(_(this.targetOfStar(e,r),r.Position),c(50,50)))}render(){this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA),this.gl.blendEquation(this.gl.FUNC_ADD),this.gl.enable(this.gl.BLEND),this.gl.useProgram(this.program),this.gl.uniform1f(this.bindings.flash,0),this.uniformVec2("dim",this.dimensions),this.uniformVec2("scrollPosition",this.scrollPosition),this.uniformVec2("mousePosition",this.mousePosition||c(-1,-1)),this.gl.uniform1f(this.bindings.pointSize,this.isSmallDims()?16:32);for(let e=0;e<this.textures.length;e++){const r=this.textures[e];this.gl.activeTexture(this.gl["TEXTURE"+e]),this.gl.bindTexture(this.gl.TEXTURE_2D,r),this.gl.uniform1i(this.gl.getUniformLocation(this.program,`u_textures[${e}]`),e)}for(let e of this.starfields)this.renderDrawStarfield(e)}renderDrawStarfield(e){this.uniformVec2("scroll",e.config.scroll);const r=parseInt(e.config.color.slice(0,2),16)/255,o=parseInt(e.config.color.slice(2,4),16)/255,a=parseInt(e.config.color.slice(4,6),16)/255;this.gl.uniform3f(this.bindings.color,r,o,a);const n=[],s=[],u=[];e.stars.forEach(m=>{n.push(m.Position.x,m.Position.y),s.push(m.Opacity),u.push(m.Texture)}),this.writeAndBindBuffer("position",this.buffers.position,new Float32Array(n),2),this.writeAndBindBuffer("opacity",this.buffers.opacity,new Float32Array(s)),this.writeAndBindBuffer("textureIndex",this.buffers.texture,new Float32Array(u)),this.gl.drawArrays(this.gl.POINTS,0,e.stars.length)}}const oe=({onInitialize:t,onInitializeFail:i,onDestroy:e,onResize:r}={})=>{let o=f.useRef(null),a=f.useRef(null);return f.useEffect(()=>{if(!o.current)return;o.current.width=o.current.clientWidth,o.current.height=o.current.clientHeight;const n=o.current.getContext("webgl2",{antialias:!1,powerPreference:"low-power",desynchronized:!0,failIfMajorPerformanceCaveat:!0});if(!n){console.log("WebGL2RenderingContext initialize failed"),i==null||i();return}return a.current=n,t==null||t(n),n.viewport(0,0,o.current.width,o.current.height),r==null||r(c(o.current.width,o.current.height),o.current),()=>{e==null||e(),a.current=null}},[o.current]),C("resize",()=>{var n;o.current&&(o.current.width=o.current.clientWidth,o.current.height=o.current.clientHeight,(n=a.current)==null||n.viewport(0,0,o.current.width,o.current.height),r==null||r(c(o.current.width,o.current.height),o.current))}),{ref:o,gl:a}},N=({update:t,fps:i=30})=>{f.useEffect(()=>{let e=performance.now();const r=setInterval(()=>{let o=performance.now();t((o-e)/i,o-e),e=o},1e3/i);return()=>clearInterval(r)},[t,i])},ne=({render:t,deltaTimeFPS:i=30})=>{N({fps:i,update:(e,r)=>{t(e)}})},se=({effects:t,onDimensionsChange:i,onInitialized:e})=>{const r=f.useRef([]),o=s=>{for(let u of r.current)Q(s,u.dimensions)||u.onDimensionsChange(s);i==null||i(s)},{ref:a,gl:n}=oe({onInitialize:s=>{r.current=t.map(([u])=>new u(s)),o({x:s.canvas.width,y:s.canvas.height}),e==null||e()},onDestroy:()=>{r.current=[]},onResize:s=>{o(s)}});return ne({render:()=>{var s,u;(s=n.current)==null||s.clearColor(0,0,0,0),(u=n.current)==null||u.clear(n.current.COLOR_BUFFER_BIT);for(let m of r.current)m.render()}}),N({fps:30,update:s=>{for(let u of r.current)u.update(1*s)}}),C("mousemove",s=>{for(let u of r.current)u.onMouseMove(c(s.clientX,s.clientY))}),{ref:a,gl:n,store:r}},ae=()=>{const{ref:t}=se({effects:[[ie]]});return A.jsxs("div",{className:"pageBackground",children:[A.jsx("div",{id:"rr1",style:{position:"absolute",left:0,bottom:0}}),A.jsx("div",{id:"rr2",style:{position:"absolute",right:0,bottom:0}}),A.jsx("canvas",{className:"pageBackground",style:{width:"100vw",height:"100vh",imageRendering:"pixelated"},ref:t})]})},ce=({children:t})=>{const i=f.useRef(null),e=f.useRef(null),r=f.useRef(null),[o,a]=f.useState(null),[n,s]=f.useState(!1),[u,m]=f.useState(!1);f.useEffect(()=>{let d=new Audio;return i.current=d,()=>{var h;(h=e.current)==null||h.close(),d.pause(),d.remove(),i.current=null}},[]),f.useEffect(()=>{if(!i.current)return;const d=new AbortController,{signal:h}=d;return i.current.addEventListener("playing",()=>{p.hide("music-error")},{signal:h}),()=>d.abort()},[]),f.useEffect(()=>{if(!i.current)return;const d=new AbortController,{signal:h}=d;return i.current.addEventListener("ended",()=>{if(!o)return;const g=L;let E=g.indexOf(o);if(E==-1)return;let S=E+1;S>=g.length&&(S=0);let b=g[S];b&&a(b)},{signal:h}),()=>d.abort()},[o]),f.useEffect(()=>{if(o)return p.show({id:"music-nowplaying",title:"Now Playing",message:o.title}),()=>void p.hide("music-nowplaying");p.hide("music-nowplaying")},[o]);const w=()=>{var d;(d=i.current)==null||d.play().then(()=>{e.current=new AudioContext;let h=e.current.createMediaElementSource(i.current);r.current=e.current.createAnalyser(),h.connect(r.current),h.connect(e.current.destination)}).catch(h=>{if(h instanceof DOMException&&h.name=="NotAllowedError"){p.show({id:"music-error",message:"Can't play music, please click anywhere",autoClose:!1,position:"top-center",color:"yellow"});const g=()=>w();window.addEventListener("click",g,{once:!0})}})};return f.useEffect(()=>{i.current&&(i.current.pause(),i.current.src=o?`/assets/music/${o.file}`:"",o&&w())},[o]),A.jsx(V.Provider,{value:{ref:i,loading:n,playing:u,currentSong:o,analyser:r,audioContext:e,changeCurrentSong:a},children:t})},pe=F(function(){return A.jsx(Y,{children:A.jsx(G,{children:A.jsxs(ce,{children:[A.jsx(ae,{}),A.jsx(O,{})]})})})});export{pe as default};
