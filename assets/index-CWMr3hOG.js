import{w as b}from"./with-props--3mHUYu9.js";import{j as i}from"./jsx-runtime-BjG_zV1W.js";import{r as o,O as j}from"./chunk-BAXFHI7N-ChQ9KoNV.js";import{M as k,L as v,a as P,U as M}from"./data-DD0Acsmr.js";import{u as C}from"./LanguageContext-BYMP4qDU.js";import{a as m}from"./notifications.store-DkDRTqJD.js";import"./random-id-CQPYUG5g.js";const E={farewellBackground:!0},R=o.createContext({...E,enable:()=>{},disable:()=>{},toggle:()=>{}}),S=({children:t})=>{const[n,r]=o.useState(E),l=s=>r(d=>({...d,[s]:!0})),e=s=>r(d=>({...d,[s]:!1})),a=s=>r(d=>({...d,[s]:!d[s]}));return i.jsx(R.Provider,{value:{...n,enable:l,disable:e,toggle:a},children:t})},g=(t,n)=>typeof t=="object"&&t!==null?{x:t.x||0,y:t.y||0}:{x:t||0,y:n||0};g(0,0);g(1,1);function A(t){return new Worker("/assets/effects.worker-WEyZr2bn.js",{name:t==null?void 0:t.name})}const L=t=>n=>n[t.type]?n[t.type](t.data):n._(),W=({onDimensionsChange:t,onInitialized:n})=>{const r=o.useRef(null),l=o.useRef(null);return o.useEffect(()=>{if(!r.current)return;const e=r.current,a=e.transferControlToOffscreen(),s=new A;return l.current=s,s.postMessage({type:"init",data:{canvas:a,dimensions:{x:e.clientWidth,y:e.clientHeight}}},[a]),s.onmessage=d=>{const p=d.data;L(p)({initialized:()=>{console.log("Effects worker initalized")}})},()=>{s.terminate(),l.current=null}},[]),C("mousemove",e=>{var s;const a=g(e.clientX,e.clientY);(s=l.current)==null||s.postMessage({type:"mousemove",data:{pos:a}})}),C("resize",()=>{var a;if(!r.current)return;const e=g(r.current.clientWidth,r.current.clientHeight);(a=l.current)==null||a.postMessage({type:"dimensionsChange",data:{dimensions:e}})}),{ref:r}},z=()=>{const{ref:t}=W({});return i.jsxs("div",{className:"pageBackground",children:[i.jsx("div",{id:"rr1",style:{position:"absolute",left:0,bottom:0}}),i.jsx("div",{id:"rr2",style:{position:"absolute",right:0,bottom:0}}),i.jsx("canvas",{className:"pageBackground",style:{width:"100vw",height:"100vh",imageRendering:"pixelated"},ref:t})]})},I=({children:t})=>{const n=o.useRef(null),r=o.useRef(null),l=o.useRef(null),[e,a]=o.useState(null),[s,d]=o.useState(!1),[p,O]=o.useState(!1);o.useEffect(()=>{let c=new Audio;return n.current=c,()=>{var u;(u=r.current)==null||u.close(),c.pause(),c.remove(),n.current=null}},[]),o.useEffect(()=>{if(!n.current)return;const c=new AbortController,{signal:u}=c;return n.current.addEventListener("playing",()=>{m.hide("music-error")},{signal:u}),()=>c.abort()},[]),o.useEffect(()=>{if(!n.current)return;const c=new AbortController,{signal:u}=c;return n.current.addEventListener("ended",()=>{if(!e)return;const f=k;let h=f.indexOf(e);if(h==-1)return;let y=h+1;y>=f.length&&(y=0);let w=f[y];w&&a(w)},{signal:u}),()=>c.abort()},[e]),o.useEffect(()=>{if(e)return m.show({id:"music-nowplaying",title:i.jsx(v,{en:"Now Playing",tr:"Şimdi Çalıyor"}),message:e.title}),()=>void m.hide("music-nowplaying");m.hide("music-nowplaying")},[e]);const x=()=>{var c;(c=n.current)==null||c.play().then(()=>{r.current=new AudioContext;let u=r.current.createMediaElementSource(n.current);l.current=r.current.createAnalyser(),u.connect(l.current),u.connect(r.current.destination)}).catch(u=>{if(u instanceof DOMException&&u.name=="NotAllowedError"){m.show({id:"music-error",message:i.jsx(v,{en:"Can't play music, please click anywhere",tr:"Müzik çalınamıyor, herhangi bir yere tıklayın"}),autoClose:!1,position:"top-center",color:"yellow"});const f=()=>x();window.addEventListener("click",f,{once:!0})}})};return o.useEffect(()=>{n.current&&(n.current.pause(),n.current.src=e?`/assets/music/${e.file}`:"",e&&x())},[e]),i.jsx(P.Provider,{value:{ref:n,loading:s,playing:p,currentSong:e,analyser:l,audioContext:r,changeCurrentSong:a},children:t})},H=b(function(){return i.jsx(S,{children:i.jsx(M,{children:i.jsxs(I,{children:[i.jsx(z,{}),i.jsx(j,{})]})})})});export{H as default};
