import{w as E}from"./with-props-DY0BKT3b.js";import{j as u}from"./jsx-runtime-BjG_zV1W.js";import{r as o,O as b}from"./chunk-KNED5TY2-Bs4SCV26.js";import{M as j,a as k,U as P}from"./data-C66Y8Qio.js";import{u as v}from"./use-window-event-gPnLv2ol.js";import{a as g}from"./notifications.store-DJz-Y7bD.js";import"./random-id-CQPYUG5g.js";const C={farewellBackground:!0},S=o.createContext({...C,enable:()=>{},disable:()=>{},toggle:()=>{}}),M=({children:t})=>{const[r,n]=o.useState(C),l=s=>n(f=>({...f,[s]:!0})),e=s=>n(f=>({...f,[s]:!1})),c=s=>n(f=>({...f,[s]:!f[s]}));return u.jsx(S.Provider,{value:{...r,enable:l,disable:e,toggle:c},children:t})},d=(t,r)=>typeof t=="object"&&t!==null?{x:t.x||0,y:t.y||0}:{x:t||0,y:r||0};d(0,0);d(1,1);d(.3,.3),d(.3,.3),d(.5,.5),d(.5,.5);function R(t){return new Worker("/assets/effects.worker-WEyZr2bn.js",{name:t==null?void 0:t.name})}const A=t=>r=>r[t.type]?r[t.type](t.data):r._(),W=({onDimensionsChange:t,onInitialized:r})=>{const n=o.useRef(null),l=o.useRef(null);return o.useEffect(()=>{if(!n.current)return;const e=n.current,c=e.transferControlToOffscreen(),s=new R;return l.current=s,s.postMessage({type:"init",data:{canvas:c,dimensions:{x:e.clientWidth,y:e.clientHeight}}},[c]),s.onmessage=f=>{const p=f.data;A(p)({initialized:()=>{console.log("Effects worker initalized")}})},()=>{s.terminate(),l.current=null}},[]),v("mousemove",e=>{var s;const c=d(e.clientX,e.clientY);(s=l.current)==null||s.postMessage({type:"mousemove",data:{pos:c}})}),v("resize",()=>{var c;if(!n.current)return;const e=d(n.current.clientWidth,n.current.clientHeight);(c=l.current)==null||c.postMessage({type:"dimensionsChange",data:{dimensions:e}})}),{ref:n}},I=()=>{const{ref:t}=W({});return u.jsxs("div",{className:"pageBackground",children:[u.jsx("div",{id:"rr1",style:{position:"absolute",left:0,bottom:0}}),u.jsx("div",{id:"rr2",style:{position:"absolute",right:0,bottom:0}}),u.jsx("canvas",{className:"pageBackground",style:{width:"100vw",height:"100vh",imageRendering:"pixelated"},ref:t})]})},L=({children:t})=>{const r=o.useRef(null),n=o.useRef(null),l=o.useRef(null),[e,c]=o.useState(null),[s,f]=o.useState(!1),[p,O]=o.useState(!1);o.useEffect(()=>{let a=new Audio;return r.current=a,()=>{var i;(i=n.current)==null||i.close(),a.pause(),a.remove(),r.current=null}},[]),o.useEffect(()=>{if(!r.current)return;const a=new AbortController,{signal:i}=a;return r.current.addEventListener("playing",()=>{g.hide("music-error")},{signal:i}),()=>a.abort()},[]),o.useEffect(()=>{if(!r.current)return;const a=new AbortController,{signal:i}=a;return r.current.addEventListener("ended",()=>{if(!e)return;const m=j;let x=m.indexOf(e);if(x==-1)return;let y=x+1;y>=m.length&&(y=0);let h=m[y];h&&c(h)},{signal:i}),()=>a.abort()},[e]),o.useEffect(()=>{if(e)return g.show({id:"music-nowplaying",title:"Now Playing",message:e.title}),()=>void g.hide("music-nowplaying");g.hide("music-nowplaying")},[e]);const w=()=>{var a;(a=r.current)==null||a.play().then(()=>{n.current=new AudioContext;let i=n.current.createMediaElementSource(r.current);l.current=n.current.createAnalyser(),i.connect(l.current),i.connect(n.current.destination)}).catch(i=>{if(i instanceof DOMException&&i.name=="NotAllowedError"){g.show({id:"music-error",message:"Can't play music, please click anywhere",autoClose:!1,position:"top-center",color:"yellow"});const m=()=>w();window.addEventListener("click",m,{once:!0})}})};return o.useEffect(()=>{r.current&&(r.current.pause(),r.current.src=e?`/assets/music/${e.file}`:"",e&&w())},[e]),u.jsx(k.Provider,{value:{ref:r,loading:s,playing:p,currentSong:e,analyser:l,audioContext:n,changeCurrentSong:c},children:t})},$=E(function(){return u.jsx(M,{children:u.jsx(P,{children:u.jsxs(L,{children:[u.jsx(I,{}),u.jsx(b,{})]})})})});export{$ as default};
