import{w as g}from"./with-props-CCmlLKWz.js";import{j as a}from"./jsx-runtime-BjG_zV1W.js";import{r as t,O as C}from"./chunk-GNGMS2XR-D0nGIQkJ.js";import{M as w,U as h}from"./MusicPlayerContext-CdHJaDTN.js";import{a as m}from"./notifications.store-yyozdE4G.js";import"./random-id-CQPYUG5g.js";const p={farewellBackground:!0},v=t.createContext({...p,enable:()=>{},disable:()=>{},toggle:()=>{}}),E=({children:l})=>{const[e,r]=t.useState(p),i=s=>r(c=>({...c,[s]:!0})),n=s=>r(c=>({...c,[s]:!1})),f=s=>r(c=>({...c,[s]:!c[s]}));return a.jsx(v.Provider,{value:{...e,enable:i,disable:n,toggle:f},children:l})},P=({children:l})=>{const e=t.useRef(null),r=t.useRef(null),i=t.useRef(null),[n,f]=t.useState(null),[s,c]=t.useState(!1),[x,j]=t.useState(!1);t.useEffect(()=>{let u=new Audio;return e.current=u,u.loop=!0,()=>{var o;(o=r.current)==null||o.close(),u.pause(),u.remove(),e.current=null}},[]),t.useEffect(()=>{e.current&&(e.current.onplaying=()=>{m.hide("music")})},[e.current]);const d=()=>{var u;(u=e.current)==null||u.play().then(()=>{r.current=new AudioContext;let o=r.current.createMediaElementSource(e.current);i.current=r.current.createAnalyser(),o.connect(i.current),o.connect(r.current.destination)}).catch(o=>{if(o instanceof DOMException&&o.name=="NotAllowedError"){m.show({id:"music",message:"Can't play music, please click anywhere",autoClose:!1});const y=()=>d();window.addEventListener("click",y,{once:!0})}})};return t.useEffect(()=>{e.current&&(e.current.src=(n==null?void 0:n.file)||"",n&&d())},[n]),a.jsx(w.Provider,{value:{ref:e,loading:s,playing:x,currentSong:n,analyser:i,audioContext:r},children:l})},k=g(function(){return a.jsx(E,{children:a.jsx(h,{children:a.jsx(P,{children:a.jsx(C,{})})})})});export{k as default};
